@model GitAspx.ViewModels.TreeViewModel
@using GitAspx;
@{ViewBag.Title = Model.Title;}
<div class="repositoryContainer">
    <table style="width: 100%">
        <tr>
            <td>
                <div class="switchBar">            
                    <ul>
                        <li>
                            <a href="javascript:void()">Branches (@Model.Repository.Branches.Count)</a>
                            <ul>
                                @foreach (var lkvpBranch in Model.Repository.Branches) {
                                    <li><a href="@Url.Content("~/" + Model.Project + "/tree/" + lkvpBranch.Key + Model.PathSegments.LeftJoin("/"))" title="@lkvpBranch.Key">@lkvpBranch.Key</a></li>
                                }
                            </ul>
                        </li>
                        <li>
                            <a href="javascript:void()">Tags (@Model.Repository.Tags.Count)</a>
                            <ul>
                                @foreach (var lkvpTag in Model.Repository.Tags) {
                                    <li><a href="@Url.Content("~/" + Model.Project + "/tree/" + lkvpTag.Key + Model.PathSegments.LeftJoin("/"))" title="@lkvpTag.Key">@lkvpTag.Key</a></li>
                                }
                            </ul>
                        </li>
                        <li>
                            <a href="javascript:void()">Parents (@Model.Branch.CurrentCommit.Ancestors.Count())</a>
                            <ul>
                                @foreach (var loCommit in Model.Branch.CurrentCommit.Ancestors) {
                                    <li>
                                        <a href="@Url.Content("~/" + Model.Project + "/tree/" + loCommit.Hash + Model.PathSegments.LeftJoin("/"))"
                                            title="@loCommit.Hash"><span style="font-size: 10px; color: green">@loCommit.CommitDate.ToPrettyDateString(): </span>@loCommit.Message.LeftOrWhole(50)
                                        </a>
                                    </li>
                                }
                            </ul>
                        </li>
                        <li>
                            <a href="javascript:void()">Cultures (5)</a>
                            <ul>
                                <li><a href="@Url.Content("~/culture/en-US")">English</a></li>
                                <li><a href="@Url.Content("~/culture/zh-TW")">繁體中文</a></li>
                                <li><a href="@Url.Content("~/culture/zh-CN")">简体中文</a></li>
                                <li><a href="@Url.Content("~/culture/ja-JP")">日本語</a></li>
                                <li><a href="@Url.Content("~/culture/de-DE")">Deutsch</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </td>
        </tr>
        <tr>
            <td style="width: 70%">                
                <div style="font-size: 130%; border: 1px dashed white; padding: 5px">
                    @foreach (string lsLine in Model.Commit.Message.SplitLines()) {
                        <div>@(new MvcHtmlString(lsLine.ToHtmlWithSpaces()))</div>
                    }
                </div>
                <div style="background-color: #DDDDDD">@Model.Commit.Committer.Name
                &lt;<a href="mailto:@Model.Commit.Committer.EmailAddress">@Model.Commit.Committer.EmailAddress</a>&gt; 
                @(Model.Commit.IsCommittedByAuthor ? "(author)" : "")</div>
                <div style="background-color: #DDDDDD">@Model.Commit.CommitDate</div>
            </td>
            <td style="background-color: #D3F968">
                <div><i>Branch</i> <b>@Model.Branch.Name</b></div>
                @if (Model.Tag != null) {
                    <div><i>Tag</i> <b>@Model.Tag.Name</b></div>
                }
                <div><i>Commit</i> <a class="hash" href="@Url.Content("~/" + Model.Project + "/commit/" + Model.Commit.Hash + Model.PathSegments.LeftJoin("/"))"
                    title="@Model.Commit.Hash">@Model.Commit.ShortHash</a></div>
                <div><i>Parent</i> @if (Model.Commit.Ancestors.Any()) {
                        var loFirstParent = Model.Commit.Ancestors.First();
                    <a class="hash" href="@Url.Content("~/" + Model.Project + "/tree/" + loFirstParent.Hash + Model.PathSegments.LeftJoin("/"))"
                        title="@loFirstParent.Hash">
                        @loFirstParent.ShortHash @loFirstParent.CommitDate.ToPrettyDateString()
                    </a>
                    }
                </div>
            </td>
        </tr>
    </table>
    <h1>@Model.Project@Model.PathSegments.LeftJoin(" / ")</h1>
        
    <div class="hint">Right click on the file to download, directory to download as zip</div>
    <ul id="repositories">
		@foreach (var dir in Model.Directories) {
			<li>
				<a class="repository" href="@Url.Content("~/" + Model.Project + "/tree/" + Model.TreeName + "/" + Model.PathSegments.RightJoin("/") + dir.Name)"
                    title="@Url.Content("~/" + Model.Project + "/download/" + Model.TreeName + "/" + Model.PathSegments.RightJoin("/") + dir.Name)">
					@dir.Name
					<span class="latest-commit">@dir.Trees.Count() directories, @dir.Leaves.Count() files</span>
				</a>
			</li>
        }
		@foreach (var file in Model.Files) {
			<li>
				<a class="repository" href="@Url.Content("~/" + Model.Project + "/blob/" + Model.TreeName + "/" + Model.PathSegments.RightJoin("/") + file.Name)"
                    title="@Url.Content("~/" + Model.Project + "/download/" + Model.TreeName + "/" + Model.PathSegments.RightJoin("/") + file.Name)">
					@file.Name
					<span class="latest-commit">@file.Size bytes</span>
				</a>
			</li>
		}
	</ul>
</div>

<script type="text/javascript">
    $(function () {
        $('a.repository').bind("contextmenu", function () {
            var url = $(this).attr('title');
            location.href = url;
            return false;
        });
    });
</script>